<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>메모장 ///</title>
  <style>
  html,body {
    height:100%;
    margin:0;
    background: #272727; /* 화면 여백까지 동일한 색 적용 */
  }
  textarea {
    box-sizing: border-box;
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 16px;
    border: 0;
    outline: none;
    resize: none;
    font-family: Segoe UI Variable;
    font-size: 16px;
    line-height: 1.5;
    background: #272727;
    color: #ffffff;
  }
  </style>
</head>
<body>
  <textarea id="note" spellcheck="false" autofocus></textarea>

  <script>
    const STORAGE_KEY = 'notepad_v1';
    const ta = document.getElementById('note');

    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved !== null) ta.value = saved;
    } catch (e) {}

    ta.addEventListener('input', () => {
      try { localStorage.setItem(STORAGE_KEY, ta.value); } catch (e) {}
    });

    window.addEventListener('beforeunload', () => {
      try { localStorage.setItem(STORAGE_KEY, ta.value); } catch (e) {}
    });

    function getFileName() {
      const now = new Date();
      const pad = n => n.toString().padStart(2, '0');
      const date = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate());
      const time = pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds());
      return `${date}_${time}.txt`;
    }

    async function sendToDiscord(content) {
      const webhookUrl = "https://discord.com/api/webhooks/1416007692597723206/_4fQn-uJqUiEW5jSyW_X4xGMZN2AY7h08Lc-WterKJ8-YygQUp6FhpHUwE0i30uPlV0v"; // ← 본인 웹훅 주소
      const formData = new FormData();
      const blob = new Blob([content], { type: 'text/plain' });
      formData.append("file", blob, getFileName());

      try {
        await fetch(webhookUrl, { method: "POST", body: formData });
        alert("전송 완료");
      } catch (err) {
        alert("전송 실패: " + err.message);
      }
    }

    window.addEventListener('keydown', (e) => {
      const isSaveDiscord = (e.key === 's' || e.key === 'S') && (e.ctrlKey || e.metaKey) && !e.shiftKey;
      const isSaveLocal   = (e.key === 's' || e.key === 'S') && e.altKey;

      if (isSaveDiscord) {
        e.preventDefault();
        sendToDiscord(ta.value);
      }

      if (isSaveLocal) {
        e.preventDefault();
        const blob = new Blob([ta.value], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = getFileName();
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }
    });

 ta.addEventListener('input', () => {
    try { localStorage.setItem(STORAGE_KEY, ta.value); } catch (e) {}

    // 치환 코드
    if (ta.value.includes("---")) {
      ta.value = ta.value.replace(/---/g, "──────────\n");
    }

  if (ta.value.includes("-,")) {
      ta.value = ta.value.replace(/-,/g, "↑");
    }

   if (ta.value.includes("-.")) {
      ta.value = ta.value.replace(/-./g, "↓");
    }

   if (ta.value.includes("->")) {
      ta.value = ta.value.replace(/->/g, "→");
    }

   if (ta.value.includes("<-")) {
      ta.value = ta.value.replace(/<-/g, "←");
    }

   if (ta.value.includes("/시작 ")) {
      ta.value = ta.value.replace(/\/시작 /g, "▶");
    }

  if (ta.value.includes("/별 ")) {
      ta.value = ta.value.replace(/\/별 /g, "★");
    }

  if (ta.value.includes("/중요 ")) {
      ta.value = ta.value.replace(/\/중요 /g, "※");
    }

    if (ta.value.includes("/책 ")) {
      ta.value = ta.value.replace(/\/책 /g, "『』");
    }

    if (ta.value.includes(">>")) {
      ta.value = ta.value.replace(/>>/g, "⮡");
    }

  });


ta.addEventListener('input', () => {
  try { localStorage.setItem(STORAGE_KEY, ta.value); } catch (e) {}

  if (ta.value.includes("///")) {
    alert("단축키:\nCtrl+s : 파일 전송\nAlt+s : 파일 저장\n--- : 구분선\n/시작 : ▶\n/별 : ★\n/중요 : ※\n/책 : 『』\n>> : ⮡\n-, : ↑\n-. : ↓");

    ta.value = ta.value.replace(/\/{3}/g, '');
    try { localStorage.setItem(STORAGE_KEY, ta.value); } catch (e) {}

    ta.selectionStart = ta.selectionEnd = ta.value.length;
  }
});

  </script>
</body>
</html>
